---
layout:false
---
<!--
 * @Author: your name
 * @Date: 2021-02-26 14:25:42
 * @LastEditTime: 2021-06-01 18:22:15
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: /www/dtk_static_www_user_center/html/单页html/首页.html
-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="App-Config"
      content="fullscreen=yes,useHistoryState=yes,transition=yes"
    />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="yes" name="apple-touch-fullscreen" />
    <meta content="telephone=no,email=no" name="format-detection" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"
    />
    <script
      type="text/javascript"
      src="https://public.ffquan.cn/lib/jquery-1.12.4.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://public.ffquan.cn/lib/vue-lazyload.js"
    ></script>
    <script
      type="text/javascript"
      src="https://public.ffquan.cn/lib/swiper/js/swiper.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://public.ffquan.cn/lib/clipboard.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://p1static.dataoke.com/web/js/layer/layer.js?t=202104191256"
    ></script>

    <title>福利清单</title>
    <script>
      var _config = {
        appKey: '#APPKEY#',//此处替换成用户appKey
        // appKey: 'sqloxk', //此处替换成用户appKeyappkey：lvllxe
        // 需要自行接入点击商品后的逻辑 （非必填）
        // jumpGoodsUrl: function (items) {   // 替换为详细页面的地址或转链逻辑
        // 	 window.open('https://xxxx&gid=' + items.goodsid);
        // }
      };
    </script>
    <style>
      a,
      abbr,
      acronym,
      address,
      applet,
      article,
      aside,
      audio,
      b,
      big,
      blockquote,
      body,
      canvas,
      caption,
      center,
      cite,
      code,
      dd,
      del,
      details,
      dfn,
      div,
      dl,
      dt,
      em,
      embed,
      fieldset,
      figcaption,
      figure,
      footer,
      form,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      header,
      hgroup,
      html,
      i,
      iframe,
      img,
      ins,
      kbd,
      label,
      legend,
      li,
      mark,
      menu,
      nav,
      object,
      ol,
      output,
      p,
      pre,
      q,
      ruby,
      s,
      samp,
      section,
      small,
      span,
      strike,
      strong,
      sub,
      summary,
      sup,
      table,
      tbody,
      td,
      tfoot,
      th,
      thead,
      time,
      tr,
      tt,
      u,
      ul,
      var,
      video {
        margin: 0;
        padding: 0;
        border: 0;
        font-size: 100%;
        font: inherit;
        vertical-align: baseline;
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        tap-highlight-color: transparent;
        box-sizing: border-box;
      }
      article,
      aside,
      details,
      figcaption,
      figure,
      footer,
      header,
      hgroup,
      menu,
      nav,
      section {
        display: block;
      }
      html {
        font-family: Arial, PingFang SC, -apple-system, BlinkMacSystemFont,
          Segoe UI, Hiragino Sans GB, Microsoft YaHei, Helvetica Neue, Helvetica,
          sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;
      }
      ol,
      ul {
        list-style: none;
      }
      blockquote,
      q {
        quotes: none;
      }
      blockquote:after,
      blockquote:before,
      q:after,
      q:before {
        content: '';
        content: none;
      }
      #appMain {
        margin: auto;
        font-size: 0.28rem;
        overflow: hidden;
        position: relative;
        z-index: 1;
        overflow: hidden;
      }
      .tmall-one-layout {
        min-height: 100vh;
        width: 100%;
        background: #f5f5f5;
        text-align: center;
      }
      .tmall-one-layout .banner {
        background: url('https://sr.ffquan.cn/dtk_yunying/20210525/c2masnv6vrkbu6t3jieg0.png')
          no-repeat center top #f52157;
        background-size: 100% auto;
        width: 100%;
        text-align: center;
        padding-top: 2.3rem;
      }
      .tmall-one-layout .tab {
        width: auto;
        height: 0.88rem;
        background: #fff;
        font-family: PingFangSC-Regular;
        font-size: 0.28rem;
        color: #666666;
        letter-spacing: 0;
        text-align: left;
        white-space: nowrap;
        line-height: 0.88rem;
        overflow-x: auto;
      }
      .tmall-one-layout .tab li {
        height: 100%;
        display: inline-block;
        padding: 0 0.23rem;
      }
      .tmall-one-layout .tab li.active {
        font-family: PingFangSC-Semibold;
        color: #ef3135;
      }

      .myswiper {
        margin: 0 0.1rem;
        position: relative;
        top: -0.1rem;
        padding: 0.5rem 0 0.2rem;
        overflow: hidden;
      }

      .goodslist {
        width: 100%;
        padding: 0.24rem 0.24rem 0.1rem;
        margin: 0;
      }
      .goodslist .list {
        width: 100%;
        background: #fff;
        border-radius: 0.08rem;
        overflow: hidden;
        display: flex;
        margin-bottom: 0.24rem;
      }
      .goodslist .list .pic {
        width: 2.72rem;
        height: 2.72rem;
      }
      .goodslist .list .pic img {
        width: 100%;
        display: block;
      }
      .goodslist .list .center {
        width: calc(100% - 2.89rem);
        position: relative;
        z-index: 0;
        margin-left: 0.17rem;
        padding-top: 0.18rem;
        text-align: left;
      }
      .goodslist .list .center h4 {
        height: 0.37rem;
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
        font-size: 0.26rem;
        font-family: PingFangSC-Regular, PingFang SC;
        font-weight: 400;
        color: #17233d;
        line-height: 0.37rem;
        margin-bottom: 0.14rem;
      }
      .goodslist .list .center h4 img {
        width: 0.24rem;
        height: 0.24rem;
        position: relative;
        top: 2px;
        margin-right: 3px;
      }
      .goodslist .list .center .tag {
        height: 0.32rem;
        margin-bottom: 0.15rem;
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
      }
      .goodslist .list .center .tag span {
        height: 0.32rem;
        display: inline-block;
        padding: 0 0.1rem;
        background: #fff2ed;
        border: 1px solid #ffccba;
        border-radius: 0.03rem;
        font-family: PingFangSC-Regular;
        font-size: 0.24rem;
        color: #ff4400;
        letter-spacing: 0;
        line-height: 0.32rem;
        text-align: center;
        margin-right: .1rem;
      }
      .goodslist .list .center .coupon {
      }
      .goodslist .list .center .coupon span {
        width: 0.94rem;
        height: 0.32rem;
        display: inline-block;
        padding-left: 0.3rem;
        background: url('https://sr.ffquan.cn/dtk_yunying/20210525/c2mccaf6vrkbu6t3jif00.png')
          center center no-repeat;
        background-size: 100% 100%;
        font-family: PingFangSC-Regular;
        font-size: 0.2rem;
        color: #ff4400;
        letter-spacing: 0;
        line-height: 0.32rem;
        text-align: center;
      }

      .goodslist .list .center .btns {
        position: absolute;
        bottom: 0.22rem;
        left: 0;
        z-index: 10;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
      }

      .goodslist .list .center .btns .sales {
        color: #17233d;
        font-size: 0.24rem;
        line-height: 0.33rem;
        padding-top: 0.11rem;
      }
      .goodslist .list .center .btns .sales span {
        color: #808695;
      }
      .goodslist .list .center .btns .ml {
        color: #ff4443;
        font-size: 0.26rem;
        line-height: 0.37rem;
        padding-top: 0.21rem;
        white-space: nowrap;
      }
      .goodslist .list .center .btns .ml b {
        font-size: 0.4rem;
        margin-right: 0.1rem;
        font-family: Arial-BoldMT;
      }
      .goodslist .list .center .btns .ml del {
        color: #c5c8ce;
        font-size: 0.2rem;
      }
      .goodslist .list .center .btns .go {
        width: 1.45rem;
        height: 0.66rem;
        line-height: 0.66rem;
        background: #ff5e4b;
        border-radius: 1rem 0px 0px 1rem;
        color: #fff;
        font-size: 0.28rem;
        font-weight: bold;
        font-family: PingFangSC-Medium;
        text-align: center;
      }

      .loading {
        line-height: 1rem;
        text-align: center;
        font-size: 0.3rem;
        color: #999;
      }
      .sys{
          width: 100%;
          height: 100vh;
          position: fixed;
          z-index: 9999999;
          background: rgba(0, 0, 0, 0.6)
          url('https://sr.ffquan.cn/dtk_yunying/20210803/c44albf6vrkd4bd59itg0.png')
          center center no-repeat;
          background-size: 2.4rem auto;
      }
      #shareID {
        position: fixed;
        left: 0;
        bottom: 0;
        z-index: 500;
        background: #fff;
        border-top: 1px solid #979797;
        padding: 0.13rem 0;
        width: 100%;
      }
      #shareID a {
        display: block;
        background: #ef3135;
        border-radius: 0.38rem;
        line-height: 0.76rem;
        height: 0.76rem;
        text-align: center;
        color: #fff;
        margin: 0 0.12rem;
        font-size: 0.36rem;
        font-family: PingFangSC-Regular;
      }

      .back_home {
        width: 30px;
        height: 30px;
        position: fixed;
        right: 0.3rem;
        bottom: 1.2rem;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .back_home img {
        width: 15px;
        height: 15px;
      }
    </style>
  </head>

  <body>
    <script
      type="text/javascript"
      src="https://public.ffquan.cn/lib/taobaoCode/taobaoCode.js?v=1.3.2"
    ></script>
    <div id="appMain">
      <div v-if="sys == null" class="sys"></div>

      <div class="tmall-one-layout">
        <div class="banner"></div>
        <ul class="tab">
          <li
            v-for="item in tabList"
            :key="item.type"
            :class="tabType === item.type ? 'active' : ''"
            @click="tabChange(item.type)"
          >
            {{item.title}}
          </li>
        </ul>
        <div class="goodslist">
          <div
            v-for="(item, index) in goodsList1"
            :key="index"
            class="list"
            :id="'goodsList'+index"
          >
            <div class="pic"><img :src="imgFomate(item.mainPic)" /></div>
            <div class="center">
              <h4>
                <img
                  v-if="item.isTmall == '1'"
                  src="https://sr.ffquan.cn/dtk_www/20200302/bpe8eev6vrkd07vi9t9g10.png"
                  alt=""
                />
                <img
                  v-if="item.isTmall != '1'"
                  src="https://p1static.dataoke.com/web/images/tipsection/ico_tb.png"
                  alt=""
                />
                {{item.title}}
              </h4>
              <div class="tag" >
                <span
                  v-for="(item_tag, index) in item.specialText"
                  key="{index}"
                  >{{item_tag}}</span
                >
              </div>
              <div class="coupon">
                <span
                  >{{item.couponPrice}}元</span
                >
              </div>

              <div class="btns">
                <div>
                  <div class="ml">
                    抢购价 ¥<b
                      >{{item.actualPrice}}</b
                    >
                    <del>¥{{item.originPrice}}</del>
                  </div>
                  <div class="sales">
                    <span>{{`${tabType === 1 ? '2小时销量' : '月销'} `}}</span>
                    {{digitalAbbNumber({ num: tabType === 1 ? item.sales2h :
                    item.salesMonth, unit: '万' })}}
                  </div>
                </div>
                <div class="go">去抢购</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="share" id="shareID"><a>立即分享</a></div>
      <div ref="reference" class="loading">加载中...</div>

      <div class="back_home" v-if="scrollTop>=230" @click="back_home">
        <img
          src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAwCAYAAAC4wJK5AAACs0lEQVRoQ+3ZTYhOURzH8e9vYWFnqcTGQsnaxmJY2WFD3kkk8pKXRFIGpSkJk5KSlBRjIkqkiNSUUoqNTCmhFClJKfXT0X007pznuc9zn3Onmeme3XNfzvl/7jnn/s+5j5gERZPAwF+E7R3AOmB+hno8jnGLgLfAoKRDIU7ZPgYcGcdBtwrtjqSlAfETmDpBESHsBQFxBtg9QRFPJfU05sRxYAMwcwTmzTiEzcli+gHcBPZL+lrZ28n2UaAHWAj0Sgq/KymVIJq8LAYkrahCkRxh+wRwuEmwlUCSImyfBA4WPO3kkGQI233AgTaHS1JIEoTtU8C+NgGNy5JBukbYPg3s6RCQFNIVwvZZYFcE8BqYlzs+ACyPXNt1j5RG2O4HwsIxX15mPZNfRPYCc6uAlELYPg9sjwBeAGuB6cAoREh4tm+khnSMsH0B2BoBPAfWSBq2HbJ0FBHuSw3pCGH7IrAlAhjKAO+yIFsiUkPaRti+BGyKAJ5lgPeNc0U9MeK6JEOrLYTty8DGCOBJBvg48ly7iFQ9UoiwfQVYHwE8AlZL+pw/1wkiBaQlwvbV8KQjgIcZ4EssyXWK6BbSFGH7GrAqEuSDcFzSt2ZZugyiG0gUYfs6EFv738sA31stM8oiykJGIWzvBM5FgrwLrJQUPiy0LN0gCiDRHWIMcQtYlovydgb4VQRoN08U1dMkIX6SNCN/bwyR3xcMZoDfRQ13mieK6otA+iWNWnDGELOy3dk2IHxh65PkogbL5omiem3vBcIQfyVpSez6wjxR1EiqV2yZdhr31IjUeaJsb9Q9UfdE2bETua8eTvVwqofT/0+gnhP1nKjnxNjMidnAcO5hb5YUvl0lL5VM7Gx3dx9Y/G+5LFXWVmUV256W/XM6BRiS9CF5F2QVVoaoKuAx29mNJSC09QfRuW93lvvKnQAAAABJRU5ErkJggg=="
          alt=""
        />
      </div>
    </div>
  </body>
</html>

<script>
  (function () {
    var size =
      document.body.clientWidth || document.documentElement.clientWidth;
    document.documentElement.style.fontSize =
      (size > 750 ? 750 : size) / 7.5 + 'px';
  })();

  Vue.use(VueLazyload, {
    preLoad: 1.3, //
    error: 'https://sr.ffquan.cn/cms_pic/20200622/bro7s7f6vrkd3jat4ujg0.png',
    loading: 'https://sr.ffquan.cn/cms_pic/20200612/brhjkf76vrkcrfpi79eg0.png',
    attempt: 1,
  });
  new Vue({
    el: '#appMain',
    data: {
      sys: false,
      time: '',
      goodsList1: [],
      loading: false,
      linkKZL: '',
      scrollTop: 0,
      canScroll: false,
      loadData: false,
      nowPage: 1,
      tabType: 1,
      tabList: [],
    },
    methods: {
      tabChange(type) {
        if (this.tabType === type) return;
        this.tabType = type;
        this.getGoodsList();
      },

      isStart(item) {
        if (this.getTime(item.activityStartTime) >= new Date()) {
          layer.msg('抢购暂未开始');
          return false;
        }
      },
      back_home() {
        $(document).scrollTop(0);
      },
      accSub: function ({ num }) {
        var r1, r2, m, n;
        try {
          r1 = num[0].toString().split('.')[1].length;
        } catch (e) {
          r1 = 0;
        }
        try {
          r2 = num[1].toString().split('.')[1].length;
        } catch (e) {
          r2 = 0;
        }
        m = Math.pow(10, Math.max(r1, r2)); //last modify by deeka //动态控制精度长度
        n = r1 >= r2 ? r1 : r2;
        return ((num[0] * m - num[1] * m) / m).toFixed(n);
      },
      digitalAbbNumber: function ({ num = 0, unit }) {
        var param = {};
        var k = 10000,
          sizes = ['', '万', '亿', '万亿'],
          i;
        if (num < k) {
          return num;
        } else {
          i = Math.floor(Math.log(num) / Math.log(k));
          param.value = parseFloat((num / Math.pow(k, i)).toFixed(1));
          param.unit = sizes[i];
        }
        return param.value + (unit || param.unit);
      },
      getTime: function (time) {
        const newTime = new Date(time.replace(/-/g, '/'));
        return newTime;
      },
      getTimeText: function (time) {
        const text = time.split(' ')[1].replace(/00:00/g, '00');
        return text;
      },

      handleClipboard: function (event, res, isGoods, text) {
        var _this = this;
        if (event.getAttribute('isCopy')) {
          return false;
        }
        event.setAttribute('isCopy', true);
        // @ts-ignore
        const clipboardImg = new window.ClipboardJS(event, {
          text: (trigger) => {
            return text || _this.handleChange(res, isGoods);
          },
        });
        clipboardImg.on('success', function (e) {
          layer.msg(
            text ? '复制成功，快分享给小伙伴吧~' : '口令复制成功，打开手淘抢购'
          );
          e.clearSelection();
        });

        clipboardImg.on('error', function (e) {
          layer.msg('口令复制失败，请联系推择者');
        });
      },

      // 活动专链接
      handleChange: function (res, isGoods) {
        // 普通商品转连逻辑
        // @ts-ignore
        var _this = this;
        console.log(res, _this);

        const resCodeEvent = new window.taobaoCode({
          type: 1, // type=>1 商品转链  2 活动转链
          modelType: 2, // 0 => 默认成功失败提示 modelType => 1 超级红包 2 =>会场弹窗 （判断类型 默认不传，用途复制成功提示文案判断）
          isRedPacket: false, // isRedPacket => true 开启红包流程  isRedPacket=> 关闭红包流程 （是否开启红包弹窗流程）
          params: {
            ...{
              site_id: _this.sys.uid,
              pid: _this.sys.pid,
              need_tpwd: 1,
              gid: res.itemId,
              goodsid: res.itemId,
              is_auto_quan: 1,
              pic: res.mainPic,
              d_title: res.title,
            },
            ...(_this.sys.channelId != ''
              ? { relationId: _this.sys.channelId }
              : {}),
          }, //参数 具体参数参照  http://wiki.haojiequ.com/?dir=interface%2F%E5%85%AC%E5%85%B1%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3-go&file=1.index.md
          regCode: /\#(.*?)\#/, //替换正则 默认 #淘口令#
          async: false, // 同步还是异步  将不会执行弹窗逻辑需要自己判断 并示例中会返回 （items=>接口专链后地址）
          template: `复制本段(#淘口令#)，打开手淘APP领取福利`, //替换模版
        });

        if (resCodeEvent.items.code != 1) {
          return false;
        }
        return resCodeEvent.items.data.TpwdNew;
        // return isGoods
        //   ? `${resCodeEvent.items.data.newTpwd} ${res.title}:/`
        //   : `0每天10点，20点抢1元爆品，复制${resCodeEvent.items.data.Tpwd}，打开手淘APP，立即抢购:/`;
      },

      getGoodsList: function (page) {
        var _this = this;
        page = page || 1;
        $.ajax({
          url:'https://dtkapi.ffquan.cn/dtk_java_views_api/api/tb/activity/promote/welfareList',
          type: 'get',
          data: {
            dataType: _this.tabType,
            pageId: page,
            pageSize: 20,
            appKey: _config.appKey,
          },
        }).done(function (res) {
          const { code, data:{ kzWebsite, list, pageId, sys, totalNum, totalPages} } = res;

          if (code != 200) {
            _this.sys = null;
            return;
          }

          _this.time = res.time;
          _this.sys = sys || null;
          _this.linkKZ = kzWebsite;

          if (_this.loadData == true) {
            res.data
              ? (_this.goodsList1 = _this.goodsList1.concat(res.data.list))
              : '';
          } else {
            res.data ? (_this.goodsList1 = res.data.list) : '';
          }

          _this.loadData = false;
          if (res.data && res.data.list.length != 0) {
            _this.canScroll = true;
          }

          setTimeout(function () {
            for (var i = 0; i < _this.goodsList1.length; i++) {
              _this.handleClipboard(
                document.getElementById('goodsList' + i),
                _this.goodsList1[i],
                true
              );
            }

            if (_this.sys.uid) {
              $.ajax({
                url: 'https://dtkapi.ffquan.cn/taobaoapi/kz-create-short',
                // url: 'http://dtkapi.haojiequ.com/taobaoapi/kz-create-short',
                type: 'get',
                data: {
                  url: `${_this.linkKZ}#/welfareList?app_key=${_config.appKey}`,
                },
              }).done(function (res) {
                _this.handleClipboard(
                  document.getElementById('shareID'),
                  {},
                  false,
                  `全网超高性价比，大牌好货应有尽有、还等什么，速抢~ ${res.data}`
                );
              });
            }
          }, 500);
        });
      },

      scrollLoad: function () {
        //
        var _this = this;
        var range = 70; //距下边界长度/单位px
        var totalheight = 0;
        $(window).scroll(function () {
          var srollPos = $(window).scrollTop(); //滚动条距顶部距离(页面超出窗口的高度)
          totalheight = parseFloat($(window).height()) + parseFloat(srollPos);

          if ($(document).height() - range <= totalheight) {
            if (_this.canScroll) {
              _this.nowPage++;
              _this.canScroll = false;
              _this.loadData = true;
              console.log(_this.nowPage);
              _this.getGoodsList(_this.nowPage);
            }
          }
        });
      },
      imgFomate: function (img) {
        if (img.indexOf('http') != '-1') {
          return img;
        } else {
          return 'https:' + img;
        }
      },
      getNav:function(){
        var _this = this;
        return $.ajax({
          url: 'https://dtkapi.ffquan.cn/dtk_java_views_api/api/tb/activity/promote/welfare/columns',
          type: 'get',
          data: {
            url: `${_this.linkKZ}#/welfareList?app_key=${_config.appKey}`,
          },
        }).done(function(res){

          _this.tabList = res.data || [
            { title: '618榜单', type: 1 },
            { title: '前N福利单', type: 2 },
            { title: '买赠活动', type: 3 },
            { title: '每日爆品', type: 4 },
            { title: '低至1.9', type: 5 },
          ];
          _this.tabType = _this.tabList[0].type;
        })
      },
    },
    mounted: function () {
      var _this = this;

      this.getNav().done(function(res){
        _this.getGoodsList();
        _this.scrollLoad();
        window.onscroll = function () {
          _this.scrollTop =
            document.documentElement.scrollTop || document.body.scrollTop;
        };
      })
      
      
    },
  });
</script>
